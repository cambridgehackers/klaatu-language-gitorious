digraph wifistates {
    node [shape=box style=filled]

    { rank=same; Initial Driver_Loaded Supplicant_Starting Driver_Started }
    { rank=same; Driver_Unloaded Driver_Unloading }
    { rank=same; Driver_Loading Driver_Failed }
    { rank=same; Connect_Mode Connecting Disconnected }
    { rank=same; Connected Disconnecting }
    { rank=same; Driver_Stopped Scan_Mode Driver_Stopping }

    Connect_Mode -> Disconnected [ label="SUP_STATE_CHANGE_EVENT\nNETWORK_DISCONNECTION_EVENT" ]
    Connect_Mode -> Disconnecting [ label="CMD_CONNECT_NETWORK\nSUP_STATE_CHANGE_EVENT" ]
    Connected -> Connecting 
    Connected -> Disconnecting [ label="DHCP_FAILURE\nCMD_DISCONNECT" ]
    Connecting -> Connect_Mode [ dir=back label=NETWORK_CONNECTION_EVENT ]
    Connecting -> Connected [ label="DHCP_SUCCESS" ]
    Connecting -> Disconnecting
    Disconnected -> Scan_Mode [ dir=both label=CMD_START_SCAN ]
    Disconnecting -> Disconnected [ label=SUP_STATE_CHANGE_EVENT ]
    Driver_Failed -> Driver_Unloading [dir=back label=CMD_UNLOAD_DRIVER_FAILURE ]
    Driver_Loaded -> Driver_Unloading [ label=CMD_UNLOAD_DRIVER ]
    Driver_Loaded -> Supplicant_Starting [ label=CMD_START_SUPPLICANT ]
    Driver_Loading -> Driver_Failed [label=CMD_LOAD_DRIVER_FAILURE]
    Driver_Loading -> Driver_Loaded [label=CMD_LOAD_DRIVER_SUCCESS]
    Driver_Started -> Disconnected
    Driver_Started -> Driver_Stopping [ label=CMD_STOP_DRIVER ]
    Driver_Started -> Scan_Mode 
    Driver_Stopped -> Driver_Started [ label=SUP_STATE_CHANGE_EVENT ]
    Driver_Stopping -> Driver_Stopped [ label=SUP_STATE_CHANGE_EVENT ]
    Driver_Unloaded -> Driver_Loading [ label=CMD_LOAD_DRIVER ]
    Driver_Unloaded -> Driver_Unloading [dir=back label=CMD_UNLOAD_DRIVER_SUCCESS ]
    Initial -> Driver_Loaded
    Initial -> Driver_Unloaded
    Supplicant_Started -> Supplicant_Stopping [ label=CMD_STOP_SUPPLICANT ]
    Supplicant_Starting -> Driver_Started [ label=SUP_CONNECTION_EVENT ]
    Supplicant_Stopping -> Driver_Loaded [ label=CMD_STOP_SUPPLICANT_FAILURE ]
    default -> Supplicant_Stopping [ label=CMD_STOP_SUPPLICANT ]
    default1 -> Driver_Loaded [ label=SUP_DISCONNECTION_EVENT ]

    Connect_Mode        [ actions="0, 1, 0, Driver_Started" ];
    Connected           [ actions="1, 1, 1, Connect_Mode" color=green ];
    Connecting          [ actions="0, 1, 0, Connect_Mode" defer="CMD_START_SCAN" ];
    Disconnected        [ actions="1, 1, 1, Connect_Mode" ];
    Disconnecting       [ actions="0, 1, 0, Connect_Mode" ];
    Driver_Failed       [ actions="0, 1, 0, Driver_Unloaded" ];
    Driver_Loaded       [ actions="0, 1, 0, default" ];
    Driver_Loading      [ actions="1, 2, 0, default" defer="CMD_LOAD_DRIVER\nCMD_UNLOAD_DRIVER\nCMD_START_SUPPLICANT\nCMD_STOP_SUPPLICANT\nCMD_START_DRIVER\nCMD_STOP_DRIVER" ];
    Driver_Started      [ actions="1, 1, 0, Supplicant_Started" ];
    Driver_Starting     [ defer="CMD_START_DRIVER\nCMD_STOP_DRIVER\nNETWORK_CONNECTION_EVENT\nNETWORK_DISCONNECTION_EVENT\nAUTHENTICATION_FAILURE_EVENT\nCMD_START_SCAN\nCMD_DISCONNECT\nCMD_REASSOCIATE\nCMD_RECONNECT" ];
    Driver_Stopped      [ actions="0, 2, 0, Supplicant_Started" color=green defer="CMD_STOP_DRIVER\nNETWORK_CONNECTION_EVENT\nNETWORK_DISCONNECTION_EVENT\nAUTHENTICATION_FAILURE_EVENT\nCMD_DISCONNECT\nCMD_REASSOCIATE\nCMD_RECONNECT" ];
    Driver_Stopping     [ actions="0, 1, 0, Supplicant_Started" defer="CMD_START_DRIVER\nCMD_STOP_DRIVER\nNETWORK_CONNECTION_EVENT\nNETWORK_DISCONNECTION_EVENT\nAUTHENTICATION_FAILURE_EVENT\nCMD_START_SCAN\nCMD_DISCONNECT\nCMD_REASSOCIATE\nCMD_RECONNECT" ];
    Driver_Unloaded     [ actions="0, 2, 0, default" ];
    Driver_Unloading    [ actions="1, 2, 0, default" defer="CMD_LOAD_DRIVER\nCMD_UNLOAD_DRIVER\nCMD_START_SUPPLICANT\nCMD_STOP_SUPPLICANT\nCMD_START_DRIVER\nCMD_STOP_DRIVER" ];
    Initial             [ color=firebrick ]; 
    Scan_Mode           [ actions="0, 0, 0, Driver_Started" ];
    Supplicant_Started  [ actions="0, 1, 1, default" ];
    Supplicant_Starting [ actions="0, 1, 0, default" defer="CMD_LOAD_DRIVER\nCMD_UNLOAD_DRIVER\nCMD_START_SUPPLICANT\nCMD_STOP_SUPPLICANT\nCMD_START_DRIVER\nCMD_STOP_DRIVER" ];
    Supplicant_Stopping [ actions="0, 1, 0, default" ];
    Unused              [ defer="CMD_ADD_OR_UPDATE_NETWORK\nCMD_DISABLE_NETWORK\nCMD_ENABLE_BACKGROUND_SCAN\nCMD_ENABLE_NETWORK\nCMD_ENABLE_RSSI_POLL\nCMD_REMOVE_NETWORK\nCMD_RSSI_POLL\nCMD_SELECT_NETWORK\nCMD_STOP_SUPPLICANT_SUCCESS\nSUP_SCAN_RESULTS_EVENT" ];
    default             [ actions="0, 1, 0, 0" ];
}
